async function main(){function a(){i.getToken().then(a=>{console.log({token:a}),d(!1),b(a)}).catch(a=>{console.log("Unable to retrieve token ",a)})}async function b(a){if(!c()){console.log("Sending token to server...");const b=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a})});b.ok?(d(!0),console.log("token sent to server")):(console.log("failed to send token to server"),d(!1))}else console.log("Token already sent to server so won't send it again unless it changes")}function c(){return"1"===window.localStorage.getItem("sentToServer")}function d(a){window.localStorage.setItem("sentToServer",a?"1":"0")}const e="https://us-central1-rksplab.cloudfunctions.net/token",f=await fetch("https://us-central1-rksplab.cloudfunctions.net/config",{method:"GET"}),{firebaseConfig:g,publicVAPIDKey:h}=await f.json();firebase.initializeApp(g),firebase.analytics();const i=firebase.messaging();i.usePublicVapidKey(h),i.onTokenRefresh(()=>a()),a()}main();